<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Readings</title>
		<link href="styleReadingsPage.css" rel="stylesheet" type="text/css">
		<script type="text/javascript" src="sideBar.json"></script>
		<div class="navigation">
  			<!--<img src="menu_button2.png" alt="" width="30" height="30" class="menu_btn" onClick="openNav()"/> -->
  			
		</div>
		<h4 class="logo" onClick="openNav()"><a herf="#">CRADLE</a></h4>
		
		<script>
        function callAwsLambdaFunction() {
										
            var http = new XMLHttpRequest();
			
			http.responseType = 'json';
			
            http.open("POST", "https://oyseokpdbi.execute-api.us-east-2.amazonaws.com/prod/cradleDownloadTest", true);
			
			
			var params= JSON.stringify({'httpMethod': 'POST', 'body':{'testType': localStorage.getItem("result"), 'PID': document.getElementById("PatientID").value}});

            http.setRequestHeader("Content-type", "application/json; charset=utf-8");

            http.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
					var struct = this.response;
					
					if(localStorage.getItem("result") == "AirFlow"){
						var intensity = struct['body'].Items[0].Intensity;
						var PPM = struct['body'].Items[0].PPM;
						var testDate = struct['body'].Items[0].TestDate;
				
						document.getElementById("server1").innerHTML = "TestDate: " + testDate;
						document.getElementById("server2").innerHTML = "intensity: " + intensity;
						document.getElementById("server3").innerHTML = "PPM: " + PPM;
						
					}
					else if(localStorage.getItem("result") == "BodyPosition"){
						var testDate = struct['body'].Items[0].TestDate;
						var xVal = struct['body'].Items[0].XValues;
						var yVal = struct['body'].Items[0].YValues;
						var zVal = struct['body'].Items[0].ZValues;
						
						document.getElementById("server1").innerHTML = "TestDate: " + testDate;
						document.getElementById("server2").innerHTML = "X-Values: " + xVal;
						document.getElementById("server3").innerHTML = "Y-Values: " + yVal;
						document.getElementById("server4").innerHTML = "Z-Values: " + zVal;
						
					}
					else if(localStorage.getItem("result") == "ECG"){
						var testDate = struct['body'].Items[0].TestDate;
						var bpm = struct['body'].Items[0].BPM;
						var signal = struct['body'].Items[0].Signal;
						
						document.getElementById("server1").innerHTML = "TestDate: " + testDate;
						document.getElementById("server2").innerHTML = "BPM: " + bpm;
						document.getElementById("server3").innerHTML = "Signal: " + signal;
						
					}
					else if(localStorage.getItem("result") == "EMG"){
						var testDate = struct['body'].Items[0].TestDate;
						var cpm = struct['body'].Items[0].CPM;
						var signal = struct['body'].Items[0].Signal;
						
						document.getElementById("server1").innerHTML = "TestDate: " + testDate;
						document.getElementById("server2").innerHTML = "CPM: " + cpm;
						document.getElementById("server3").innerHTML = "Signal: " + signal;
					
					}
					else if(localStorage.getItem("result") == "GSR"){
						var testDate = struct['body'].Items[0].TestDate;
						var gsrConductance = struct['body'].Items[0].GSRConductanceResults;
						var gsrResistance = struct['body'].Items[0].GSRResistanceResults;
						
						document.getElementById("server1").innerHTML = "TestDate: " + testDate;
						document.getElementById("server2").innerHTML = "Conductance: " + gsrConductance;
						document.getElementById("server3").innerHTML = "Resistance: " + gsrResistance;
					
					}
					//SPO2 to be made...
				}
                else {
                    document.getElementById("serverRes").innerHTML = "Invalid Patient ID, please try again";
                }
            };
            http.send(params);

        }
    </script>
		
	</head>
	
	<body>
		<div id="mySidenav" class="sidenav">
 			 <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
  			<a href="main.html">About</a>
  			<a href="sensors.html">Sensors</a>
  			<a href="#">Analysis</a>
		</div>

		<div class="main">
			<h4>Please enter a PID to view results</h4>
				<form method="post">
					<input type="text" name="v" placeholder="PID" required="required" id="PatientID"/>
					<input type="button" class="btn-primary btn-block btn-large tag" style="text-decoration:none;" value="View" id="submit" onClick="callAwsLambdaFunction()"/>
					<!--<button onClick= "callAwsLambdaFunction()"> click me!</button> -->
					<h6 id="serverRes"></h6>
					
					<h5 id="server1"></h5>
					<h5 id="server2"></h5>
					<h5 id="server3"></h5>
					<h5 id="server4"></h5>
			
				</form>
			
		</div>
    </body>
</html>